"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.removeEntitiesFromState = exports.updateEntitiesInState = exports.addEntitiesToState = exports.upsertEntitiesToState = exports.updateState = exports.updateEntitieStatus = exports.updateActionErrors = exports.updateActionCache = exports.removeActionFromCache = exports.addActionToCache = void 0;var _lodash = require("lodash");function _defineProperty(obj, key, value) {if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}






var addActionToCache = function addActionToCache(state, uuid, cache) {return (
    Object.assign({}, state.actionCache, _defineProperty({}, uuid, cache)));};exports.addActionToCache = addActionToCache;

var removeActionFromCache = function removeActionFromCache(state, uuid) {return (
    (0, _lodash.omit)(state.actionCache, uuid));};exports.removeActionFromCache = removeActionFromCache;

var updateActionCache = function updateActionCache(state, uuid, cache) {return (
    cache ?
    addActionToCache(state, uuid, cache) :
    removeActionFromCache(state, uuid));};exports.updateActionCache = updateActionCache;

var updateActionErrors = function updateActionErrors(state, action) {return (
    Object.assign({}, state.actionErrors, _defineProperty({},
    action.uuid, {
      message: action.error,
      action: action })));};exports.updateActionErrors = updateActionErrors;



var updateEntitieStatus = function updateEntitieStatus(state, name, statuses) {return (
    Object.assign({}, state.entitieStatus, _defineProperty({}, name, Object.assign({}, state.entitieStatus[name], statuses))));};exports.updateEntitieStatus = updateEntitieStatus;

var updateState = function updateState(state, action, _ref) {var _ref$entitiesUpdate = _ref.entitiesUpdate,entitiesUpdate = _ref$entitiesUpdate === void 0 ? {} : _ref$entitiesUpdate,cacheUpdate = _ref.cacheUpdate,statusUpdate = _ref.statusUpdate,entityName = _ref.entityName;return (
    Object.assign({}, state, entitiesUpdate, {
      actionCache: cacheUpdate ? updateActionCache(state, cacheUpdate.uuid, cacheUpdate.entities) : {},
      entitieStatus: statusUpdate ? updateEntitieStatus(state, entityName, statusUpdate.statuses) : {},
      actionErrors: action.error ? updateActionErrors(state, action) : {},
      lastAction: action }));};exports.updateState = updateState;


var upsertEntitiesToState = function upsertEntitiesToState(state, action, _ref2) {var _ref2$entities = _ref2.entities,entities = _ref2$entities === void 0 ? {} : _ref2$entities,_ref2$statuses = _ref2.statuses,statuses = _ref2$statuses === void 0 ? {} : _ref2$statuses,entityName = _ref2.entityName;
  var entitiesUpdate = (0, _lodash.mapValues)(entities, function (entity, name) {return (
      Object.assign({}, state[name], entity));});

  return updateState(state, action, {
    entitiesUpdate: entitiesUpdate,
    statusUpdate: { statuses: statuses, entities: entities },
    entityName: entityName });

};exports.upsertEntitiesToState = upsertEntitiesToState;

var addEntitiesToState = function addEntitiesToState(state, action, _ref3) {var _ref3$entities = _ref3.entities,entities = _ref3$entities === void 0 ? {} : _ref3$entities,_ref3$statuses = _ref3.statuses,statuses = _ref3$statuses === void 0 ? {} : _ref3$statuses,_ref3$cache = _ref3.cache,cache = _ref3$cache === void 0 ? false : _ref3$cache,entityName = _ref3.entityName;var
  uuid = action.uuid;
  var entitiesUpdate = (0, _lodash.mapValues)(entities, function (entity, name) {return (
      Object.assign({}, state[name],
      cache ?
      (0, _lodash.mapValues)(entity, function (item) {return (
          Object.assign({}, item, { _temp: true }));}) :


      entity));});


  return updateState(state, action, {
    entitiesUpdate: entitiesUpdate,
    cacheUpdate: { uuid: uuid, entities: cache ? entities : null },
    statusUpdate: { statuses: statuses, entities: entities },
    entityName: entityName });

};exports.addEntitiesToState = addEntitiesToState;

var updateEntitiesInState = function updateEntitiesInState(state, action, _ref4) {var _ref4$entities = _ref4.entities,entities = _ref4$entities === void 0 ? {} : _ref4$entities,_ref4$statuses = _ref4.statuses,statuses = _ref4$statuses === void 0 ? {} : _ref4$statuses,_ref4$cache = _ref4.cache,cache = _ref4$cache === void 0 ? false : _ref4$cache,entityName = _ref4.entityName;var
  uuid = action.uuid;
  var affectedEntities = (0, _lodash.mapValues)(entities, function (entity, name) {return (
      (0, _lodash.pick)(state[name], (0, _lodash.keys)(entity)));});

  var entitiesUpdate = (0, _lodash.mapValues)(entities, function (entity, name) {return (
      Object.assign({}, state[name], (0, _lodash.mapValues)(state[name], function (item, key) {return (
          entity[key] ?
          (0, _lodash.omit)(
          Object.assign({}, item, entity[key], { _temp: true }),
          cache ? [] : ['_temp']) :


          item);})));});


  return updateState(state, action, {
    entitiesUpdate: entitiesUpdate,
    cacheUpdate: { uuid: uuid, entities: cache ? affectedEntities : null },
    statusUpdate: { statuses: statuses, entities: entities },
    entityName: entityName });

};exports.updateEntitiesInState = updateEntitiesInState;

var removeEntitiesFromState = function removeEntitiesFromState(state, action, _ref5) {var _ref5$entities = _ref5.entities,entities = _ref5$entities === void 0 ? {} : _ref5$entities,_ref5$statuses = _ref5.statuses,statuses = _ref5$statuses === void 0 ? {} : _ref5$statuses,_ref5$cache = _ref5.cache,cache = _ref5$cache === void 0 ? false : _ref5$cache,entityName = _ref5.entityName;var
  uuid = action.uuid;
  var affectedEntities = (0, _lodash.mapValues)(entities, function (entity, name) {return (
      (0, _lodash.pick)(state[name], (0, _lodash.keys)(entity)));});

  var entitiesUpdate = (0, _lodash.mapValues)(entities, function (entity, name) {return (
      (0, _lodash.omit)(state[name], (0, _lodash.keys)(entity)));});

  return updateState(state, action, {
    entitiesUpdate: entitiesUpdate,
    cacheUpdate: { uuid: uuid, entities: cache ? affectedEntities : null },
    statusUpdate: { statuses: statuses, entities: entities },
    entityName: entityName });

};exports.removeEntitiesFromState = removeEntitiesFromState;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS9yZWR1Y2Vycy9zdGF0ZU9wZXJhdGlvbnMuanMiXSwibmFtZXMiOlsiYWRkQWN0aW9uVG9DYWNoZSIsInN0YXRlIiwidXVpZCIsImNhY2hlIiwiT2JqZWN0IiwiYXNzaWduIiwiYWN0aW9uQ2FjaGUiLCJyZW1vdmVBY3Rpb25Gcm9tQ2FjaGUiLCJ1cGRhdGVBY3Rpb25DYWNoZSIsInVwZGF0ZUFjdGlvbkVycm9ycyIsImFjdGlvbiIsImFjdGlvbkVycm9ycyIsIm1lc3NhZ2UiLCJlcnJvciIsInVwZGF0ZUVudGl0aWVTdGF0dXMiLCJuYW1lIiwic3RhdHVzZXMiLCJlbnRpdGllU3RhdHVzIiwidXBkYXRlU3RhdGUiLCJlbnRpdGllc1VwZGF0ZSIsImNhY2hlVXBkYXRlIiwic3RhdHVzVXBkYXRlIiwiZW50aXR5TmFtZSIsImVudGl0aWVzIiwibGFzdEFjdGlvbiIsInVwc2VydEVudGl0aWVzVG9TdGF0ZSIsImVudGl0eSIsImFkZEVudGl0aWVzVG9TdGF0ZSIsIml0ZW0iLCJfdGVtcCIsInVwZGF0ZUVudGl0aWVzSW5TdGF0ZSIsImFmZmVjdGVkRW50aXRpZXMiLCJrZXkiLCJyZW1vdmVFbnRpdGllc0Zyb21TdGF0ZSJdLCJtYXBwaW5ncyI6InlYQUFBLGdDOzs7Ozs7O0FBT08sSUFBTUEsZ0JBQWdCLEdBQUcsU0FBbkJBLGdCQUFtQixDQUFDQyxLQUFELEVBQVFDLElBQVIsRUFBY0MsS0FBZDtBQUM5QkMsSUFBQUEsTUFBTSxDQUFDQyxNQUFQLENBQWMsRUFBZCxFQUFrQkosS0FBSyxDQUFDSyxXQUF4QixzQkFBd0NKLElBQXhDLEVBQStDQyxLQUEvQyxFQUQ4QixHQUF6QixDOztBQUdBLElBQU1JLHFCQUFxQixHQUFHLFNBQXhCQSxxQkFBd0IsQ0FBQ04sS0FBRCxFQUFRQyxJQUFSO0FBQ25DLHNCQUFLRCxLQUFLLENBQUNLLFdBQVgsRUFBd0JKLElBQXhCLENBRG1DLEdBQTlCLEM7O0FBR0EsSUFBTU0saUJBQWlCLEdBQUcsU0FB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QURnQztBQUVoQ0MsSUFBQUEsV0FBVyxFQUFFLEVBQUVsQixJQUFJLEVBQUpBLElBQUYsRUFBUXFCLFFBQVEsRUFBRXBCLEtBQUssR0FBRzRCLGdCQUFILEdBQXNCLElBQTdDLEVBRm1CO0FBR2hDVixJQUFBQSxZQUFZLEVBQUUsRUFBRUwsUUFBUSxFQUFSQSxRQUFGLEVBQVlPLFFBQVEsRUFBUkEsUUFBWixFQUhrQjtBQUloQ0QsSUFBQUEsVUFBVSxFQUFWQSxVQUpnQyxFQUFoQixDQUFsQjs7QUFNRCxDQWRNLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIG1hcFZhbHVlcyxcclxuICBwaWNrLFxyXG4gIGtleXMsXHJcbiAgb21pdFxyXG59IGZyb20gJ2xvZGFzaCc7XHJcblxyXG5leHBvcnQgY29uc3QgYWRkQWN0aW9uVG9DYWNoZSA9IChzdGF0ZSwgdXVpZCwgY2FjaGUpID0+XHJcbiAgT2JqZWN0LmFzc2lnbih7fSwgc3RhdGUuYWN0aW9uQ2FjaGUsIHsgW3V1aWRdOiBjYWNoZSB9KTtcclxuXHJcbmV4cG9ydCBjb25zdCByZW1vdmVBY3Rpb25Gcm9tQ2FjaGUgPSAoc3RhdGUsIHV1aWQpID0+XHJcbiAgb21pdChzdGF0ZS5hY3Rpb25DYWNoZSwgdXVpZCk7XHJcblxyXG5leHBvcnQgY29uc3QgdXBkYXRlQWN0aW9uQ2FjaGUgPSAoc3RhdGUsIHV1aWQsIGNhY2hlKSA9PlxyXG4gIGNhY2hlID9cclxuICAgIGFkZEFjdGlvblRvQ2FjaGUoc3RhdGUsIHV1aWQsIGNhY2hlKSA6XHJcbiAgICByZW1vdmVBY3Rpb25Gcm9tQ2FjaGUoc3RhdGUsIHV1aWQpO1xyXG5cclxuZXhwb3J0IGNvbnN0IHVwZGF0ZUFjdGlvbkVycm9ycyA9IChzdGF0ZSwgYWN0aW9uKSA9PlxyXG4gIE9iamVjdC5hc3NpZ24oe30sIHN0YXRlLmFjdGlvbkVycm9ycywge1xyXG4gICAgW2FjdGlvbi51dWlkXToge1xyXG4gICAgICBtZXNzYWdlOiBhY3Rpb24uZXJyb3IsXHJcbiAgICAgIGFjdGlvblxyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IHVwZGF0ZUVudGl0aWVTdGF0dXMgPSAoc3RhdGUsIG5hbWUsIHN0YXR1c2VzKSA9PlxyXG4gIE9iamVjdC5hc3NpZ24oe30sIHN0YXRlLmVudGl0aWVTdGF0dXMsIHsgW25hbWVdOiBPYmplY3QuYXNzaWduKHt9LCBzdGF0ZS5lbnRpdGllU3RhdHVzW25hbWVdLCBzdGF0dXNlcykgfSk7XHJcblxyXG5leHBvcnQgY29uc3QgdXBkYXRlU3RhdGUgPSAoc3RhdGUsIGFjdGlvbiwgeyBlbnRpdGllc1VwZGF0ZSA9IHt9LCBjYWNoZVVwZGF0ZSwgc3RhdHVzVXBkYXRlLCBlbnRpdHlOYW1lIH0pID0+XHJcbiAgT2JqZWN0LmFzc2lnbih7fSwgc3RhdGUsIGVudGl0aWVzVXBkYXRlLCB7XHJcbiAgICBhY3Rpb25DYWNoZTogY2FjaGVVcGRhdGUgPyB1cGRhdGVBY3Rpb25DYWNoZShzdGF0ZSwgY2FjaGVVcGRhdGUudXVpZCwgY2FjaGVVcGRhdGUuZW50aXRpZXMpIDoge30sXHJcbiAgICBlbnRpdGllU3RhdHVzOiBzdGF0dXNVcGRhdGUgPyB1cGRhdGVFbnRpdGllU3RhdHVzKHN0YXRlLCBlbnRpdHlOYW1lLCBzdGF0dXNVcGRhdGUuc3RhdHVzZXMpIDoge30sXHJcbiAgICBhY3Rpb25FcnJvcnM6IGFjdGlvbi5lcnJvciA/IHVwZGF0ZUFjdGlvbkVycm9ycyhzdGF0ZSwgYWN0aW9uKSA6IHt9LFxyXG4gICAgbGFzdEFjdGlvbjogYWN0aW9uXHJcbiAgfSk7XHJcblxyXG5leHBvcnQgY29uc3QgdXBzZXJ0RW50aXRpZXNUb1N0YXRlID0gKHN0YXRlLCBhY3Rpb24sIHsgZW50aXRpZXMgPSB7fSwgc3RhdHVzZXMgPSB7fSwgZW50aXR5TmFtZSB9KSA9PiB7XHJcbiAgbGV0IGVudGl0aWVzVXBkYXRlID0gbWFwVmFsdWVzKGVudGl0aWVzLCAoZW50aXR5LCBuYW1lKSA9PlxyXG4gICAgT2JqZWN0LmFzc2lnbih7fSwgc3RhdGVbbmFtZV0sIGVudGl0eSlcclxuICApO1xyXG4gIHJldHVybiB1cGRhdGVTdGF0ZShzdGF0ZSwgYWN0aW9uLCB7XHJcbiAgICBlbnRpdGllc1VwZGF0ZSxcclxuICAgIHN0YXR1c1VwZGF0ZTogeyBzdGF0dXNlcywgZW50aXRpZXMgfSxcclxuICAgIGVudGl0eU5hbWVcclxuICB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBhZGRFbnRpdGllc1RvU3RhdGUgPSAoc3RhdGUsIGFjdGlvbiwgeyBlbnRpdGllcyA9IHt9LCBzdGF0dXNlcyA9IHt9LCBjYWNoZSA9IGZhbHNlLCBlbnRpdHlOYW1lIH0pID0+IHtcclxuICBjb25zdCB7IHV1aWQgfSA9IGFjdGlvbjtcclxuICBsZXQgZW50aXRpZXNVcGRhdGUgPSBtYXBWYWx1ZXMoZW50aXRpZXMsIChlbnRpdHksIG5hbWUpID0+XHJcbiAgICBPYmplY3QuYXNzaWduKHt9LCBzdGF0ZVtuYW1lXSwgKFxyXG4gICAgICBjYWNoZSA/XHJcbiAgICAgICAgbWFwVmFsdWVzKGVudGl0eSwgaXRlbSA9PlxyXG4gICAgICAgICAgT2JqZWN0LmFzc2lnbih7fSwgaXRlbSwgeyBfdGVtcDogdHJ1ZSB9KVxyXG4gICAgICAgIClcclxuICAgICAgICA6XHJcbiAgICAgICAgZW50aXR5XHJcbiAgICApKVxyXG4gICk7XHJcbiAgcmV0dXJuIHVwZGF0ZVN0YXRlKHN0YXRlLCBhY3Rpb24sIHtcclxuICAgIGVudGl0aWVzVXBkYXRlLFxyXG4gICAgY2FjaGVVcGRhdGU6IHsgdXVpZCwgZW50aXRpZXM6IGNhY2hlID8gZW50aXRpZXMgOiBudWxsIH0sXHJcbiAgICBzdGF0dXNVcGRhdGU6IHsgc3RhdHVzZXMsIGVudGl0aWVzIH0sXHJcbiAgICBlbnRpdHlOYW1lXHJcbiAgfSk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgdXBkYXRlRW50aXRpZXNJblN0YXRlID0gKHN0YXRlLCBhY3Rpb24sIHsgZW50aXRpZXMgPSB7fSwgc3RhdHVzZXMgPSB7fSwgY2FjaGUgPSBmYWxzZSwgZW50aXR5TmFtZSB9KSA9PiB7XHJcbiAgY29uc3QgeyB1dWlkIH0gPSBhY3Rpb247XHJcbiAgY29uc3QgYWZmZWN0ZWRFbnRpdGllcyA9IG1hcFZhbHVlcyhlbnRpdGllcywgKGVudGl0eSwgbmFtZSkgPT5cclxuICAgIHBpY2soc3RhdGVbbmFtZV0sIGtleXMoZW50aXR5KSlcclxuICApO1xyXG4gIGxldCBlbnRpdGllc1VwZGF0ZSA9IG1hcFZhbHVlcyhlbnRpdGllcywgKGVudGl0eSwgbmFtZSkgPT5cclxuICAgIE9iamVjdC5hc3NpZ24oe30sIHN0YXRlW25hbWVdLCBtYXBWYWx1ZXMoc3RhdGVbbmFtZV0sIChpdGVtLCBrZXkpID0+XHJcbiAgICAgIGVudGl0eVtrZXldID9cclxuICAgICAgICBvbWl0KFxyXG4gICAgICAgICAgT2JqZWN0LmFzc2lnbih7fSwgaXRlbSwgZW50aXR5W2tleV0sIHsgX3RlbXA6IHRydWUgfSksXHJcbiAgICAgICAgICBjYWNoZSA/IFtdIDogWydfdGVtcCddXHJcbiAgICAgICAgKVxyXG4gICAgICAgIDpcclxuICAgICAgICBpdGVtXHJcbiAgICApKVxyXG4gICk7XHJcbiAgcmV0dXJuIHVwZGF0ZVN0YXRlKHN0YXRlLCBhY3Rpb24sIHtcclxuICAgIGVudGl0aWVzVXBkYXRlLFxyXG4gICAgY2FjaGVVcGRhdGU6IHsgdXVpZCwgZW50aXRpZXM6IGNhY2hlID8gYWZmZWN0ZWRFbnRpdGllcyA6IG51bGwgfSxcclxuICAgIHN0YXR1c1VwZGF0ZTogeyBzdGF0dXNlcywgZW50aXRpZXMgfSxcclxuICAgIGVudGl0eU5hbWVcclxuICB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCByZW1vdmVFbnRpdGllc0Zyb21TdGF0ZSA9IChzdGF0ZSwgYWN0aW9uLCB7IGVudGl0aWVzID0ge30sIHN0YXR1c2VzID0ge30sIGNhY2hlID0gZmFsc2UsIGVudGl0eU5hbWUgfSkgPT4ge1xyXG4gIGNvbnN0IHsgdXVpZCB9ID0gYWN0aW9uO1xyXG4gIGNvbnN0IGFmZmVjdGVkRW50aXRpZXMgPSBtYXBWYWx1ZXMoZW50aXRpZXMsIChlbnRpdHksIG5hbWUpID0+XHJcbiAgICBwaWNrKHN0YXRlW25hbWVdLCBrZXlzKGVudGl0eSkpXHJcbiAgKTtcclxuICBsZXQgZW50aXRpZXNVcGRhdGUgPSBtYXBWYWx1ZXMoZW50aXRpZXMsIChlbnRpdHksIG5hbWUpID0+XHJcbiAgICBvbWl0KHN0YXRlW25hbWVdLCBrZXlzKGVudGl0eSkpXHJcbiAgKTtcclxuICByZXR1cm4gdXBkYXRlU3RhdGUoc3RhdGUsIGFjdGlvbiwge1xyXG4gICAgZW50aXRpZXNVcGRhdGUsXHJcbiAgICBjYWNoZVVwZGF0ZTogeyB1dWlkLCBlbnRpdGllczogY2FjaGUgPyBhZmZlY3RlZEVudGl0aWVzIDogbnVsbCB9LFxyXG4gICAgc3RhdHVzVXBkYXRlOiB7IHN0YXR1c2VzLCBlbnRpdGllcyB9LFxyXG4gICAgZW50aXR5TmFtZVxyXG4gIH0pO1xyXG59OyJdfQ==